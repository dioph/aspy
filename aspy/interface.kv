<GridLayout>:
    padding: 5

<BoxLayout>:
    visible: True
    size_hint_x: 1 if self.visible else 0
    size_hint_y: 1 if self.visible else 0
    opacity: 1 if self.visible else 0
    disabled: not self.visible
    padding: 5
    barra_id: 0
    v: 1.0e3
    vbase: 1.0e3
    vnom1: 1.0e3
    vnom2: 1.0e3
    snom: 1.0e6
    delta: 0.0
    pl: 0.0
    ql: 0.0
    pg: 0.0
    qg: 0.0
    l: 80e3
    rho: 17.8e-9
    d12: 1.0
    d23: 1.0
    d31: 1.0
    d: 50e-2
    jx: 0.0
    m: 1
    r: 2.5e-2

<Button>:
    visible: True
    size_hint_x: 1 if self.visible else 0
    size_hint_y: 1 if self.visible else 0
    opacity: 1 if self.visible else 0
    disabled: not self.visible
    coords: (0, 0)
    info: None
    padding: 0.2, 0.2

<Label>:
    visible: True
    size_hint_x: 1 if self.visible else 0
    size_hint_y: 0.5 if self.visible else 0
    opacity: 1 if self.visible else 0
    disabled: not self.visible
    markup: True
    font_name: './data/cmuntt.ttf'
    font_size: '18sp'

<TextInput>:
    visible: True
    size_hint_x: 1 if self.visible else 0
    size_hint_y: 0.5 if self.visible else 0
    opacity: 1 if self.visible else 0
    disabled: not self.visible
    multiline: False
    font_name: './data/cmuntt.ttf'
    font_size: '18sp'

<Interface>:
    GridLayout:
        rows: 2
        GridLayout:
            size_hint: 0.1, 0.1
            pos: 1, 1
            rows: 1
            cols: 3
            Button:
                text: 'Save'
                size_hint: None, 1
                pos_hint: 0.5, 1
                on_release: root.show_save()
            Button:
                text: 'Load'
                size_hint: None, 1
                pos_hint: 1, 1
                on_release: root.show_load()
            Button:
                text: 'Report'
                size_hint: None, 1
                pos_hint: 1, 1
                on_press: root.report(grid, [grid.rows, grid.cols])  # Todo: Check this line!
        GridLayout:
            rows: 1
            id: toplevel
            GridLayout:
                rows: 4
                id: elements
                size_hint: 0.5, 1
                padding: (0, 12)
                ### TOGGLEBUTTONS ###
                ## LT ##
                ToggleButton:
                    canvas:
                        Rectangle:
                            pos: self.pos
                            size: self.size
                            source: './data/buttons/TOGGLE_lt.jpg' if self.state != 'down' else './data/buttons/TOGGLE_lt_down.jpg'
                    id: lt
                    info: 'lt'
                    group: "elements"
                ## PQ ##
                ToggleButton:
                    canvas:
                        Rectangle:
                            pos: self.pos
                            size: self.size
                            source: './data/buttons/TOGGLE_pq.jpg' if self.state != 'down' else './data/buttons/TOGGLE_pq_down.jpg'
                    id: pq
                    info: 'pq'
                    group: "elements"
                ## PV ##
                ToggleButton:
                    canvas:
                        Rectangle:
                            pos: self.pos
                            size: self.size
                            source: './data/buttons/TOGGLE_pv.jpg' if self.state != 'down' else './data/buttons/TOGGLE_pv_down.jpg'
                    id: pv
                    info: 'pv'
                    group: "elements"
                ## TRAFO ##
                ToggleButton:
                    canvas:
                        Rectangle:
                            pos: self.pos
                            size: self.size
                            source: './data/buttons/TOGGLE_trafo.jpg' if self.state != 'down' else './data/buttons/TOGGLE_trafo_down.jpg'
                    id: trafo
                    info: 'trafo'
                    background_width: self.size
                    group: "elements"

            BoxLayout:
                on_parent: root.init_grid(grid, elements, toplevel)
                orientation: 'vertical'
                GridLayout:
                    id: grid
                    cols: 10
                    rows: 10

            BoxLayout:
                ### SLACK ###
                orientation: 'vertical'
                size_hint: 0.5, 1
                id: inspectSL
                visible: False
                size_hint_x: 0.5 if self.visible else 0
                Label:
                    id: NomeBarraSL
                    text: "Barra #0 (SLACK)"
                    visible: inspectSL.visible
                BoxLayout:
                    orientation: 'horizontal'
                    id: VBarraSL
                    visible: inspectSL.visible
                    Label:
                        visible: inspectSL.visible
                        text: "V (kV) ="
                    FloatInput:
                        visible: inspectSL.visible
                        text: str(inspectSL.v/1e3)
                        on_text_validate: root.edited_element(inspectSL)
                BoxLayout:
                    orientation: 'horizontal'
                    id: VBaseSL
                    visible: inspectSL.visible
                    Label:
                        visible: inspectSL.visible
                        text: "V[sub]base[/sub] (kV) ="
                    FloatInput:
                        visible: inspectSL.visible
                        text: str(inspectSL.vbase/1e3)
                        on_text_validate: root.edited_element(inspectSL)
                BoxLayout:
                    orientation: 'horizontal'
                    id: deltaBarraSL
                    visible: inspectSL.visible
                    Label:
                        visible: inspectSL.visible
                        text: "\u03B4 (\u00B0) ="
                    FloatInput:
                        visible: inspectSL.visible
                        text: str(inspectSL.delta)
                        on_text_validate: root.edited_element(inspectSL)
                BoxLayout:
                    orientation: 'horizontal'
                    id: PgBarraSL
                    visible: inspectSL.visible
                    Label:
                        visible: inspectSL.visible
                        text: "P[sub]G[/sub] (MW) ="
                    Label:
                        visible: inspectSL.visible
                        text: str(inspectSL.pg/1e6)
                BoxLayout:
                    orientation: 'horizontal'
                    id: QgBarraSL
                    visible: inspectSL.visible
                    Label:
                        visible: inspectSL.visible
                        text: "Q[sub]G[/sub] (Mvar) ="
                    Label:
                        visible: inspectSL.visible
                        text: str(inspectSL.qg/1e6)
                BoxLayout:
                    orientation: 'horizontal'
                    id: PlBarraSL
                    visible: inspectSL.visible
                    Label:
                        visible: inspectSL.visible
                        text: "P[sub]L[/sub] (MW) ="
                    FloatInput:
                        visible: inspectSL.visible
                        text: str(inspectSL.pl/1e6)
                        on_text_validate: root.edited_element(inspectSL)
                BoxLayout:
                    orientation: 'horizontal'
                    id: QlBarraSL
                    visible: inspectSL.visible
                    Label:
                        visible: inspectSL.visible
                        text: "Q[sub]L[/sub] (Mvar) ="
                    FloatInput:
                        visible: inspectSL.visible
                        text: str(inspectSL.ql/1e6)
                        on_text_validate: root.edited_element(inspectSL)

            BoxLayout:
                ### LT ###
                orientation: 'vertical'
                size_hint: 0.5, 1
                id: inspectLT
                visible: False
                size_hint_x: 0.5 if self.visible else 0
                Label:
                    id: NomeLT
                    text: "Linha de Transmissao"
                    visible: inspectLT.visible
                BoxLayout:
                    orientation: 'horizontal'
                    id: lLT
                    visible: inspectLT.visible
                    Label:
                        visible: inspectLT.visible
                        text: "l (km) ="
                    FloatInput:
                        visible: inspectLT.visible
                        text: str(inspectLT.l/1e3)
                        on_text_validate: root.edited_element(inspectLT)
                BoxLayout:
                    orientation: 'horizontal'
                    id: rhoLT
                    visible: inspectLT.visible
                    Label:
                        visible: inspectLT.visible
                        text: "\u03C1 (n\u03A9m) ="
                    FloatInput:
                        visible: inspectLT.visible
                        text: str(inspectLT.rho/1e-9)
                        on_text_validate: root.edited_element(inspectLT)
                BoxLayout:
                    orientation: 'horizontal'
                    id: rLT
                    visible: inspectLT.visible
                    Label:
                        visible: inspectLT.visible
                        text: "r (cm) ="
                    FloatInput:
                        visible: inspectLT.visible
                        text: str(inspectLT.r/1e-2)
                        on_text_validate: root.edited_element(inspectLT)
                BoxLayout:
                    orientation: 'horizontal'
                    id: D12LT
                    visible: inspectLT.visible
                    Label:
                        visible: inspectLT.visible
                        text: "D[sub]12[/sub] (m) ="
                    FloatInput:
                        visible: inspectLT.visible
                        text: str(inspectLT.d12)
                        on_text_validate: root.edited_element(inspectLT)
                BoxLayout:
                    orientation: 'horizontal'
                    id: D23LT
                    Label:
                        visible: inspectLT.visible
                        text: "D[sub]23[/sub] (m) ="
                    FloatInput:
                        visible: inspectLT.visible
                        text: str(inspectLT.d23)
                        on_text_validate: root.edited_element(inspectLT)
                BoxLayout:
                    orientation: 'horizontal'
                    id: D31LT
                    Label:
                        visible: inspectLT.visible
                        text: "D[sub]31[/sub] (m) ="
                    FloatInput:
                        visible: inspectLT.visible
                        text: str(inspectLT.d31)
                        on_text_validate: root.edited_element(inspectLT)
                BoxLayout:
                    orientation: 'horizontal'
                    id: dLT
                    Label:
                        visible: inspectLT.visible
                        text: "d (cm) ="
                    FloatInput:
                        visible: inspectLT.visible
                        text: str(inspectLT.d/1e-2)
                        on_text_validate: root.edited_element(inspectLT)
                BoxLayout:
                    orientation: 'horizontal'
                    id: mLT
                    visible: inspectLT.visible
                    Label:
                        visible: inspectLT.visible
                        text: "condutores\npor fase"
                    FloatInput:
                        visible: inspectLT.visible
                        text: str(inspectLT.m)
                        on_text_validate: root.edited_element(inspectLT)
                Button:
                    id: removeLT
                    visible: inspectLT.visible
                    text: "REMOVE"
                    on_press: root.removed_element(inspectLT.coords)
            BoxLayout:
                ### PQ ###
                orientation: 'vertical'
                size_hint: 0.5, 1
                id: inspectPQ
                visible: False
                size_hint_x: 0.5 if self.visible else 0
                Label:
                    id: NomeBarraPQ
                    text: "Barra #" + str(inspectPQ.barra_id)
                    visible: inspectPQ.visible
                BoxLayout:
                    orientation: 'horizontal'
                    id: VBarraPQ
                    visible: inspectPQ.visible
                    Label:
                        visible: inspectPQ.visible
                        text: "V (kV) ="
                    Label:
                        visible: inspectPQ.visible
                        text: str(inspectPQ.v/1e3)
                BoxLayout:
                    orientation: 'horizontal'
                    id: deltaBarraPQ
                    visible: inspectPQ.visible
                    Label:
                        visible: inspectPQ.visible
                        text: "\u03B4 (\u00B0) ="
                    Label:
                        visible: inspectPQ.visible
                        text: str(inspectPQ.delta)
                BoxLayout:
                    orientation: 'horizontal'
                    id: PBarraPQ
                    visible: inspectPQ.visible
                    Label:
                        visible: inspectPQ.visible
                        text: "P[sub]L[/sub] (MW) ="
                    FloatInput:
                        visible: inspectPQ.visible
                        text: str(inspectPQ.pl/1e3)
                        on_text_validate: root.edited_element(inspectPQ)
                BoxLayout:
                    orientation: 'horizontal'
                    id: QBarraPQ
                    visible: inspectPQ.visible
                    Label:
                        visible: inspectPQ.visible
                        text: "Q[sub]L[/sub] (Mvar) ="
                    FloatInput:
                        visible: inspectPQ.visible
                        text: str(inspectPQ.ql/1e3)
                        on_text_validate: root.edited_element(inspectPQ)
                BoxLayout:
                    orientation: 'horizontal'
                    id: ExtPQ
                    visible: inspectPQ.visible
                    Button:
                        visible: inspectPQ.visible
                    Button:
                        visible: inspectPQ.visible
                Button:
                    id: removeBarraPQ
                    visible: inspectPQ.visible
                    text: "REMOVE"
                    on_press: root.removed_element(inspectPQ.coords)

            BoxLayout:
                ### PV ###
                orientation: 'vertical'
                size_hint: 0.5, 1
                id: inspectPV
                visible: False
                size_hint_x: 0.5 if self.visible else 0
                Label:
                    id: NomeBarraPV
                    text: "Barra #" + str(inspectPV.barra_id)
                    visible: inspectPV.visible
                BoxLayout:
                    orientation: 'horizontal'
                    id: VBarraPV
                    visible: inspectPV.visible
                    Label:
                        visible: inspectPV.visible
                        text: "V (kV) ="
                    FloatInput:
                        visible: inspectPV.visible
                        text: str(inspectPV.v/1e3)
                        on_text_validate: root.edited_element(inspectPV)
                BoxLayout:
                    orientation: 'horizontal'
                    id: deltaBarraPV
                    visible: inspectPV.visible
                    Label:
                        visible: inspectPV.visible
                        text: "\u03B4 (\u00B0) ="
                    Label:
                        visible: inspectPV.visible
                        text: str(inspectPV.delta)
                BoxLayout:
                    orientation: 'horizontal'
                    id: PgBarraPV
                    visible: inspectPV.visible
                    Label:
                        visible: inspectPV.visible
                        text: "P[sub]G[/sub] (MW) ="
                    FloatInput:
                        visible: inspectPV.visible
                        text: str(inspectPV.pg/1e6)
                        on_text_validate: root.edited_element(inspectPV)
                BoxLayout:
                    orientation: 'horizontal'
                    id: QgBarraPV
                    visible: inspectPV.visible
                    Label:
                        visible: inspectPV.visible
                        text: "Q[sub]G[/sub] (Mvar) ="
                    Label:
                        visible: inspectPV.visible
                        text: str(inspectPV.qg/1e6)
                BoxLayout:
                    orientation: 'horizontal'
                    id: PlBarraPV
                    visible: inspectPV.visible
                    Label:
                        visible: inspectPV.visible
                        text: "P[sub]L[/sub] (MW) ="
                    FloatInput:
                        visible: inspectPV.visible
                        text: str(inspectPV.pl/1e6)
                        on_text_validate: root.edited_element(inspectPV)
                BoxLayout:
                    orientation: 'horizontal'
                    id: QlBarraPV
                    visible: inspectPV.visible
                    Label:
                        visible: inspectPV.visible
                        text: "Q[sub]L[/sub] (Mvar) ="
                    FloatInput:
                        visible: inspectPV.visible
                        text: str(inspectPV.ql/1e6)
                        on_text_validate: root.edited_element(inspectPV)
                BoxLayout:
                    orientation: 'horizontal'
                    id: ExtPV
                    visible: inspectPV.visible
                    Button:
                        visible: inspectPV.visible
                    Button:
                        visible: inspectPV.visible
                Button:
                    id: removeBarraPV
                    visible: inspectPV.visible
                    text: "REMOVE"
                    on_press: root.removed_element(inspectPV.coords)

            BoxLayout:
                ### trafo ###
                orientation: 'vertical'
                size_hint: 0.5, 1
                id: inspectTRAFO
                visible: False
                size_hint_x: 0.5 if self.visible else 0
                Label:
                    id: NomeTrafo
                    text: "Trafo"
                    visible: inspectTRAFO.visible
                BoxLayout:
                    orientation: 'horizontal'
                    id: V1TRAFO
                    visible: inspectTRAFO.visible
                    Label:
                        visible: inspectTRAFO.visible
                        text: "V[sub]nom1[/sub] (kV) ="
                    FloatInput:
                        visible: inspectTRAFO.visible
                        text: str(inspectTRAFO.vnom1/1e3)
                        on_text_validate: root.edited_element(inspectTRAFO)
                BoxLayout:
                    orientation: 'horizontal'
                    id: V2TRAFO
                    visible: inspectTRAFO.visible
                    Label:
                        visible: inspectTRAFO.visible
                        text: "V[sub]nom2[/sub] (kV) ="
                    FloatInput:
                        visible: inspectTRAFO.visible
                        text: str(inspectTRAFO.vnom2/1e3)
                        on_text_validate: root.edited_element(inspectTRAFO)
                BoxLayout:
                    orientation: 'horizontal'
                    id: STRAFO
                    visible: inspectTRAFO.visible
                    Label:
                        visible: inspectTRAFO.visible
                        text: "S[sub]nom[/sub] (MVA) ="
                    FloatInput:
                        visible: inspectTRAFO.visible
                        text: str(inspectTRAFO.snom/1e6)
                        on_text_validate: root.edited_element(inspectTRAFO)
                BoxLayout:
                    orientation: 'horizontal'
                    id: XTRAFO
                    visible: inspectTRAFO.visible
                    Label:
                        visible: inspectTRAFO.visible
                        text: "X (pu) ="
                    FloatInput:
                        visible: inspectTRAFO.visible
                        text: str(inspectTRAFO.jx)
                        on_text_validate: root.edited_element(inspectTRAFO)
                Button:
                    id: removeTRAFO
                    visible: inspectTRAFO.visible
                    text: "REMOVE"
                    on_press: root.removed_element(inspectTRAFO.coords)

            BoxLayout:
                ### default ###
                orientation: 'vertical'
                size_hint: 0.5, 1
                id: inspectDefault
                visible: True
                size_hint_x: 0.5 if self.visible else 0

<LoadDialog>:
    BoxLayout:
        size: root.size
        pos: root.pos
        orientation: "vertical"
        FileChooserListView:
            id: filechooser

        BoxLayout:
            size_hint_y: None
            height: 30
            Button:
                text: "Cancel"
                on_release: root.cancel()

            Button:
                text: "Load"
                on_release: root.load(filechooser.path, filechooser.selection)

<SaveDialog>:
    text_input: text_input
    BoxLayout:
        size: root.size
        pos: root.pos
        orientation: "vertical"
        FileChooserListView:
            id: filechooser
            on_selection: text_input.text = self.selection and self.selection[0] or ''

        TextInput:
            id: text_input
            size_hint_y: None
            height: 30
            multiline: False

        BoxLayout:
            size_hint_y: None
            height: 30
            Button:
                text: "Cancel"
                on_release: root.cancel()

            Button:
                text: "Save"
                on_release: root.save(filechooser.path, text_input.text)
